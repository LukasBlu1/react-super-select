'use strict';var _values2=require('lodash/values'),_values3=_interopRequireDefault(_values2),_uniqueId2=require('lodash/uniqueId'),_uniqueId3=_interopRequireDefault(_uniqueId2),_reject2=require('lodash/reject'),_reject3=_interopRequireDefault(_reject2),_reduce2=require('lodash/reduce'),_reduce3=_interopRequireDefault(_reduce2),_noop2=require('lodash/noop'),_noop3=_interopRequireDefault(_noop2),_map2=require('lodash/map'),_map3=_interopRequireDefault(_map2),_last2=require('lodash/last'),_last3=_interopRequireDefault(_last2),_isUndefined2=require('lodash/isUndefined'),_isUndefined3=_interopRequireDefault(_isUndefined2),_isString2=require('lodash/isString'),_isString3=_interopRequireDefault(_isString2),_isObject2=require('lodash/isObject'),_isObject3=_interopRequireDefault(_isObject2),_isNumber2=require('lodash/isNumber'),_isNumber3=_interopRequireDefault(_isNumber2),_isFunction2=require('lodash/isFunction'),_isFunction3=_interopRequireDefault(_isFunction2),_isEqual2=require('lodash/isEqual'),_isEqual3=_interopRequireDefault(_isEqual2),_isEmpty2=require('lodash/isEmpty'),_isEmpty3=_interopRequireDefault(_isEmpty2),_isArray2=require('lodash/isArray'),_isArray3=_interopRequireDefault(_isArray2),_includes2=require('lodash/includes'),_includes3=_interopRequireDefault(_includes2),_head2=require('lodash/head'),_head3=_interopRequireDefault(_head2),_groupBy2=require('lodash/groupBy'),_groupBy3=_interopRequireDefault(_groupBy2),_forIn2=require('lodash/forIn'),_forIn3=_interopRequireDefault(_forIn2),_find2=require('lodash/find'),_find3=_interopRequireDefault(_find2),_filter2=require('lodash/filter'),_filter3=_interopRequireDefault(_filter2),_extend2=require('lodash/extend'),_extend3=_interopRequireDefault(_extend2),_bindAll2=require('lodash/bindAll'),_bindAll3=_interopRequireDefault(_bindAll2),_classnames=require('classnames'),_classnames2=_interopRequireDefault(_classnames),_propTypes=require('prop-types'),_propTypes2=_interopRequireDefault(_propTypes),_react=require('react'),_react2=_interopRequireDefault(_react);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _ref=_react2.default.createElement('span',null),_ref2=_react2.default.createElement('span',null),_ref3=_react2.default.createElement('span',null),ReactSuperSelect=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,a.call(this,c));return d.SEARCH_FOCUS_ID=-1,d.SELECTED_OPTION_REGEX=/r-ss-selected/,d.keymap={down:40,end:35,enter:13,esc:27,home:36,space:32,tab:9,up:38},d.ariaRelevantKeydownCodes=(0,_values3.default)(d.keymap),d.lastUserSelectedOption=void 0,d._rssDOM={},d.state={ajaxError:!1,controlId:d.props.controlId||(0,_uniqueId3.default)('rss_'),data:d._configureDataSource(d.props.dataSource),rawDataSource:d.props.dataSource,isOpen:!1,focusedId:void 0,labelKey:d.props.optionLabelKey,lastOptionId:(0,_isArray3.default)(d.props.dataSource)&&0<d.props.dataSource.length?d.props.dataSource.length-1:void 0,searchString:'',value:d._buildInitialValue(),valueKey:d.props.optionValueKey},(0,_bindAll3.default)(d,['toggleDropdown','_ariaGetActiveDescendentId','_ariaGetListId','_arrestScroll','_broadcastChange','_buildInitialValue','_clearSearchString','_clearSelection','_closeOnKeypress','_configureDataSource','_defaultSearchFilter','_deselectAction','_fetchDataViaAjax','_fetchNextPage','_filterDataBySearchString','_findArrayOfOptionDataObjectsByValue','_focusCurrentFocusedId','_focusDOMOption','_focusRemovalButtons','_focusTrigger','_generateValueDisplay','_getAjaxErrorMarkup','_getDataSource','_getDropdownContent','_getFocusedOptionKey','_getGroupHeadingMarkup','_getNoResultsMarkup','_getNormalDisplayMarkup','_getLoadingMarkup','_getOptionIndexFromTarget','_getOptionsMarkup','_getOptionValueFromDataAttr','_getPagingLi','_getSearchContent','_getTagsDisplayMarkup','_getTagMarkup','_getTagRemoveIndex','_getTemplatedOptions','_getTypeSafeOptionValue','_handleDocumentClick','_handleKeyDown','_handleSearch','_isCurrentlySelected','_isMultiSelect','_isUserSearchTypingEvent','_mapDataToOptionsMarkup','_moveFocusDown','_moveFocusUp','_needsAjaxFetch','_onDownKey','_onEndKey','_onEnterKey','_onEscKey','_onHomeKey','_onMouseMove','_onUpKey','_pageFetchingComplete','_removeAllOptionsInOptionIdRange','_removeSelectedOptionByValue','_removeTagKeyPress','_removeTagClick','_selectAllOptionsInOptionIdRange','_selectAllOptionsToLastUserSelectedOption','_selectFocusedOption','_selectItemByValues','_selectItemOnOptionClick','_setFocusIdToSearch','_setFocusOnOpen','_setFocusToTagRemovalIfPresent','_updateFocusedId']),d}return _inherits(b,a),b.prototype.componentDidMount=function componentDidMount(){var a=this;this.props.disabled||(document.addEventListener('click',this._handleDocumentClick),document.addEventListener('touchstart',this._handleDocumentClick),this.props.openOnMount&&this.setState({isOpen:!0},function(){a.props.focusOnMount&&!(0,_isFunction3.default)(a.props.ajaxDataFetch)&&a._moveFocusDown()}))},b.prototype.componentWillUnmount=function componentWillUnmount(){document.removeEventListener('click',this._handleDocumentClick),document.removeEventListener('touchstart',this._handleDocumentClick)},b.prototype.componentWillReceiveProps=function componentWillReceiveProps(a){var b={};if((0,_isUndefined3.default)(a.optionLabelKey)||a.optionLabelKey===this.props.optionLabelKey||(b.labelKey=a.optionLabelKey),(0,_isUndefined3.default)(a.optionValueKey)||a.optionValueKey===this.props.optionValueKey||(b.valueKey=a.optionValueKey),!(0,_isEqual3.default)(this.props.dataSource,a.dataSource)){this.lastUserSelectedOption=void 0;var c=this.props.clearSelectedValueOnDataSourceChange?[]:this.state.value;b=(0,_extend3.default)(b,{data:this._configureDataSource(a.dataSource),rawDataSource:a.dataSource,focusedId:void 0,value:c,lastOptionId:(0,_isArray3.default)(a.dataSource)&&0<a.dataSource.length?a.dataSource.length-1:void 0})}(0,_isEqual3.default)(a.initialValue,this.props.initialValue)||(b.value=this._buildInitialValue(a)),(0,_isEmpty3.default)(b)||this.setState(b,this._broadcastChange)},b.prototype.componentDidUpdate=function componentDidUpdate(a,b){if(this._focusCurrentFocusedId(),this.state.isOpen!==b.isOpen){var c=this.state.isOpen?this.props.onOpenDropdown:this.props.onCloseDropdown;c()}},b.prototype.render=function render(){var a=this,b=(0,_classnames2.default)('carat',{down:!this.state.isOpen,up:this.state.isOpen}),c=this.props.clearSelectionLabelString?this.props.clearSelectionLabelString:this.props.clearSelectionLabelString,d=this._getDropdownContent(),e=this.props.placeholder?this.props.placeholder:this.props.placeholder,f=(0,_classnames2.default)('r-ss-trigger',{"r-ss-open":this.state.isOpen,"r-ss-disabled":this.props.disabled,"r-ss-placeholder":1>this.state.value.length}),g=this.state.value.length?this._generateValueDisplay():e,h=(0,_classnames2.default)('r-ss-wrap',this.props.customClass,{"r-ss-expanded":this.state.isOpen}),i=null;return(0,_isEmpty3.default)(this.state.value)||!1===this.props.clearable||(i=_react2.default.createElement('button',{"aria-label":c,ref:function ref(b){a._rssDOM.selectionClear=b},name:'clearSelection',type:'button',className:'r-ss-selection-clear',onClick:this._clearSelection,onKeyDown:this._clearSelection},_ref)),_react2.default.createElement('div',{ref:function ref(b){a._rssDOM.rssControl=b},id:this.state.controlId,className:h},_react2.default.createElement('div',{ref:function ref(b){a._rssDOM.triggerDiv=b},className:f,onBlur:this.props.onBlur,onClick:this.toggleDropdown,onKeyDown:this._handleKeyDown,role:'combobox',"aria-activedescendant":this._ariaGetActiveDescendentId(),"aria-disabled":this.props.disabled,"aria-haspopup":!0,"aria-controls":this._ariaGetListId(),"aria-label":e,"aria-multiselectable":this._isMultiSelect(),tabIndex:'0'},g,i,_react2.default.createElement('span',{ref:function ref(b){a._rssDOM.carat=b},className:b},' ')),d)},b.prototype.toggleDropdown=function toggleDropdown(){var a=this;if(!this.props.disabled){var b={isOpen:!this.state.isOpen};this.state.isOpen&&(0,_extend3.default)(b,{focusedId:void 0});var c=!this.state.isOpen;this.setState(b,function(){c&&a._setFocusOnOpen()})}},b.prototype._ariaGetActiveDescendentId=function _ariaGetActiveDescendentId(){var a=null,b=this._getFocusedOptionKey();return this._rssDOM[b]&&(a=this._rssDOM[b].id),a},b.prototype._ariaGetListId=function _ariaGetListId(){return this.state.controlId+'_list'},b.prototype._arrestEvent=function _arrestEvent(a){a.stopPropagation(),a.preventDefault()},b.prototype._arrestScroll=function _arrestScroll(a){if(this.props.forceDefaultBrowserScrolling)return!0;var b=!1,c=this._rssDOM.scrollWrap.scrollTop+this._rssDOM.scrollWrap.clientHeight;0<a.deltaY?c>=this._rssDOM.scrollWrap.scrollHeight&&(b=!0):0>=this._rssDOM.scrollWrap.scrollTop&&(b=!0),b&&this._arrestEvent(a)},b.prototype._broadcastChange=function _broadcastChange(){var a=this._isMultiSelect()?this.state.value:(0,_head3.default)(this.state.value);a=(0,_isEmpty3.default)(a)?void 0:a,this.props.onChange(a)},b.prototype._buildInitialValue=function _buildInitialValue(a){a=a||this.props;var b=[];return(0,_isUndefined3.default)(a.initialValue)||(b=(0,_isArray3.default)(a.initialValue)?a.initialValue:[a.initialValue],!this._isMultiSelect()&&(b=[(0,_head3.default)(b)])),b},b.prototype._clearSearchString=function _clearSearchString(){var a=this;this.setState({searchString:''},function(){a.props.onSearchInputChange(a.state.searchString),a._setFocusIdToSearch()})},b.prototype._clearSelection=function _clearSelection(a){var b=this;(a.which===this.keymap.enter||a.which===this.keymap.space||'click'===a.type)&&(a.stopPropagation(),this.setState({value:[]},function(){b.state.isOpen&&b._setFocusOnOpen(),b.lastUserSelectedOption=void 0,b._focusTrigger(),b._broadcastChange(),b.props.onClear()}))},b.prototype._closeOnKeypress=function _closeOnKeypress(){this.state.isOpen&&this.setState({isOpen:!1,focusedId:void 0},this._focusTrigger)},b.prototype._configureDataSource=function _configureDataSource(a){if((0,_isArray3.default)(a))return a;if((0,_isObject3.default)(a)){if((0,_isArray3.default)(a.collection))return a.collection;if((0,_isFunction3.default)(a.get)){var b=a.get('collection');if((0,_isArray3.default)(b))return b}}return[]},b.prototype._deselectAction=function _deselectAction(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=this.props.closeOnSelectedOptionClick&&!b;if(!this.props.deselectOnSelectedOptionClick)return c&&this._closeOnKeypress(),!1;var d=c?this._closeOnKeypress:_noop3.default;this._removeSelectedOptionByValue(a,d)},b.prototype._defaultSearchFilter=function _defaultSearchFilter(a){var b=this.state.searchString.toLowerCase(),c=(0,_isString3.default)(a[this.state.labelKey])?a[this.state.labelKey]:a[this.state.labelKey].toString();return-1<c.toLowerCase().indexOf(b)},b.prototype._fetchDataViaAjax=function _fetchDataViaAjax(){var a=this;this.props.ajaxDataFetch(this.state.rawDataSource).then(function(b){a.setState({ajaxError:!1,data:a._configureDataSource(b),rawDataSource:b},function(){a.props.openOnMount&&a.props.focusOnMount&&a._moveFocusDown()})},function(){a.setState({ajaxError:!0,rawDataSource:[]})})},b.prototype._fetchNextPage=function _fetchNextPage(){var a=this;this.props.pageDataFetch(this.state.rawDataSource).then(function(b){a.setState({ajaxError:!1,data:a._configureDataSource(b),rawDataSource:b,isFetchingPage:!1})},function(){a.setState({ajaxError:!0})})},b.prototype._filterDataBySearchString=function _filterDataBySearchString(a){var b=this,c=this._defaultSearchFilter;return(0,_isFunction3.default)(this.props.customFilterFunction)&&(c=function(a,c,d){return b.props.customFilterFunction.apply(b,[a,c,d,b.state.searchString.toLowerCase()])}),(0,_filter3.default)(a,c)},b.prototype._findArrayOfOptionDataObjectsByValue=function _findArrayOfOptionDataObjectsByValue(a){var b=this,c=(0,_isArray3.default)(a)?(0,_map3.default)(a,this.state.valueKey):[a];return(0,_reject3.default)(this.state.data,function(a){return!(0,_includes3.default)(c,a[b.state.valueKey])})},b.prototype._focusCurrentFocusedId=function _focusCurrentFocusedId(){return 0>this.state.focusedId?void this._focusSearch():void this._focusDOMOption()},b.prototype._focusDOMOption=function _focusDOMOption(){var a=this._getFocusedOptionKey();this._rssDOM[a]&&(0,_isFunction3.default)(this._rssDOM[a].focus)&&this._rssDOM[a].focus()},b.prototype._focusSearch=function _focusSearch(){this._rssDOM.searchInput&&this._rssDOM.searchInput.focus()},b.prototype._focusRemovalButtons=function _focusRemovalButtons(a){var b,c,d=this._rssDOM.triggerDiv,e=d.getElementsByTagName('button');if(e.length)for(var f=0;f<e.length;f++)e[f]===document.activeElement&&(b=f,c=a.shiftKey?f-1:f+1);e[c]?(this._arrestEvent(a),e[c].focus()):c&&0>c?this._focusTrigger():e[0]&&!(0,_isNumber3.default)(b)&&(this._arrestEvent(a),e[0].focus())},b.prototype._focusTrigger=function _focusTrigger(){this._rssDOM.triggerDiv.focus()},b.prototype._generateValueDisplay=function _generateValueDisplay(){return this.props.customSelectedValueTemplateFunction?this.props.customSelectedValueTemplateFunction(this.state.value):this.props.tags?this._getTagsDisplayMarkup():this._getNormalDisplayMarkup()},b.prototype._getAjaxErrorMarkup=function _getAjaxErrorMarkup(){var a=this,b=this.props.ajaxErrorString?this.props.ajaxErrorString:this.ajaxErrorString;return _react2.default.createElement('li',{className:'r-ss-dropdown-option error'},_react2.default.createElement('i',{ref:function ref(b){a._rssDOM.errorDisplay=b}},b))},b.prototype._getDataSource=function _getDataSource(){var a=(0,_isArray3.default)(this.state.data)?this.state.data:[];return(0,_isString3.default)(this.state.searchString)&&!(0,_isEmpty3.default)(this.state.searchString)&&(a=this._filterDataBySearchString(a)),this.props.groupBy&&(a=(0,_groupBy3.default)(a,this.props.groupBy)),a},b.prototype._getDropdownContent=function _getDropdownContent(){var a=this;if(!this.state.isOpen)return null;var b=this._getSearchContent(),c=this.props.pageDataFetch?this._onMouseMove:null,d=this.state.isFetchingPage?this._getPagingLi():null;return _react2.default.createElement('div',{ref:function ref(b){a._rssDOM.dropdownContent=b},className:'r-ss-dropdown',onKeyDown:this._handleKeyDown},b,_react2.default.createElement('div',{ref:function ref(b){a._rssDOM.scrollWrap=b},className:'r-ss-options-wrap',onMouseMove:c},_react2.default.createElement('ul',{className:'r-ss-dropdown-options',ref:function ref(b){a._rssDOM.dropdownOptionsList=b},tabIndex:'-1',id:this._ariaGetListId(),role:'listbox',"aria-expanded":this.state.isOpen,onWheel:this._arrestScroll},this._getOptionsMarkup()),d))},b.prototype._getFocusedOptionKey=function _getFocusedOptionKey(){return'option_'+this.state.focusedId},b.prototype._getGroupHeadingMarkup=function _getGroupHeadingMarkup(a){if(!a)return null;var b=(0,_classnames2.default)('r-ss-option-group-heading',this.props.customGroupHeadingClass),c=this.props.customGroupHeadingTemplateFunction?this.props.customGroupHeadingTemplateFunction(a):a;return _react2.default.createElement('li',{tabIndex:'-1',className:b,key:'heading_'+a,role:'separator',"aria-label":a,"aria-hidden":!0},c)},b.prototype._getNoResultsMarkup=function _getNoResultsMarkup(){var a=this,b=_react2.default.createElement('i',{ref:function ref(b){a._rssDOM.noResults=b}},this.props.noResultsString);return(0,_isString3.default)(this.props.noResultsString)||(b=_react2.default.createElement('div',{ref:function ref(b){a._rssDOM.noResults=b}},this.props.noResultsString)),_react2.default.createElement('li',{className:'r-ss-dropdown-option',tabIndex:'-1'},b)},b.prototype._getNormalDisplayMarkup=function _getNormalDisplayMarkup(){var a=this;return(0,_map3.default)(this.state.value,function(b){var c='r_ss_selected_'+b[a.state.labelKey];return a.props.customOptionTemplateFunction?a.props.customOptionTemplateFunction(b):_react2.default.createElement('span',{key:c,className:'r-ss-selected-label'},b[a.state.labelKey])})},b.prototype._getLoadingMarkup=function _getLoadingMarkup(){var a=this,b=this.props.customLoaderClass?'r-ss-loader '+this.props.customLoaderClass:'r-ss-loader';return _react2.default.createElement('span',{ref:function ref(b){a._rssDOM.loader=b},className:b})},b.prototype._getOptionIndexFromTarget=function _getOptionIndexFromTarget(a){return parseInt(a.getAttribute('data-option-index'),10)},b.prototype._getOptionsMarkup=function _getOptionsMarkup(){var a=this;if(this._needsAjaxFetch())return this._fetchDataViaAjax(),this._getPagingLi();if(this.state.ajaxError)return this._getAjaxErrorMarkup();var b=this._getDataSource(),c=[],d=0;return(0,_isArray3.default)(b)||(0,_isEmpty3.default)(b)?c=this._getTemplatedOptions(b):(0,_forIn3.default)(b,function(b,e){c.push(a._getGroupHeadingMarkup(e)),c=c.concat(a._getTemplatedOptions(b,d)),d+=b.length}),c},b.prototype._getOptionValueFromDataAttr=function _getOptionValueFromDataAttr(a){var b=a.getAttribute('data-option-value');return this._getTypeSafeOptionValue(b)},b.prototype._getPagingLi=function _getPagingLi(){return _react2.default.createElement('li',{key:'page_loading',className:'r-ss-page-fetch-indicator',tabIndex:'-1'},this._getLoadingMarkup())},b.prototype._getSearchContent=function _getSearchContent(){var a=this;if(!this.props.searchable)return null;var b=this.props.clearSearchLabelString?this.props.clearSearchLabelString:this.props.clearSearchLabelString,c=this.props.customSearchIconClass?this.props.customSearchIconClass:'r-ss-magnifier',d=this.props.searchPlaceholder?this.props.searchPlaceholder:this.props.searchPlaceholder,e=this.state.controlId+'_search',f=e+'_label',g=null;return(0,_isString3.default)(this.state.searchString)&&!(0,_isEmpty3.default)(this.state.searchString)&&(g=_react2.default.createElement('button',{"aria-label":b,ref:function ref(b){a._rssDOM.searchClear=b},name:'clearSearch',type:'button',className:'r-ss-search-clear',onClick:this._clearSearchString,onKeyDown:this._clearSearchString},_ref2)),_react2.default.createElement('div',{className:'r-ss-search-wrap'},_react2.default.createElement('div',{className:'r-ss-search-inner'},_react2.default.createElement('label',{ref:function ref(b){a._rssDOM.searchInputLabel=b},id:f,className:'r-ss-search-aria-label',htmlFor:e},d),_react2.default.createElement('input',{ref:function ref(b){a._rssDOM.searchInput=b},placeholder:d,onClick:this._setFocusIdToSearch,onBlur:this.props.onSearchInputBlur,onChange:this._handleSearch,value:this.state.searchString,name:e,id:e,"aria-labelledby":f,"aria-autocomplete":'list'}),g,_react2.default.createElement('i',{className:c},'search')))},b.prototype._getTagsDisplayMarkup=function _getTagsDisplayMarkup(){var a=this;return(0,_map3.default)(this.state.value,function(b){return a._getTagMarkup(b)})},b.prototype._getTagMarkup=function _getTagMarkup(a){var b=this,c=a[this.state.valueKey],d=this._getTagRemoveIndex(c),e=a[this.state.labelKey],f=this.props.customTagClass?'r-ss-tag '+this.props.customTagClass:'r-ss-tag',g=this.props.tagRemoveLabelString?this.props.tagRemoveLabelString:this.props.tagRemoveLabelString;return g=g+' '+e,_react2.default.createElement('span',{className:f,key:'tag_'+c},_react2.default.createElement('span',{className:'r-ss-tag-label'},e),_react2.default.createElement('button',{"aria-label":g,ref:function ref(a){b._rssDOM[d]=a},name:'RemoveTag_'+c,type:'button',className:'r-ss-tag-remove',onClick:this._removeTagClick.bind(null,a),onKeyDown:this._removeTagKeyPress.bind(null,a)},_ref3))},b.prototype._getTagRemoveIndex=function _getTagRemoveIndex(a){return'tag_remove_'+a},b.prototype._getTemplatedOptions=function _getTemplatedOptions(a,b){b=b||0;var c=this._mapDataToOptionsMarkup(a,b);return 0===c.length&&(c=this._getNoResultsMarkup()),c},b.prototype._getTypeSafeOptionValue=function _getTypeSafeOptionValue(a){return+a+''===a?+a:a},b.prototype._handleDocumentClick=function _handleDocumentClick(){var a=Array.prototype.slice.call(arguments)[0],b=document.body.contains(a.target);(!this._rssDOM.rssControl||b&&!this._rssDOM.rssControl.contains(a.target))&&this.state.isOpen&&this.setState({isOpen:!1,focusedId:void 0})},b.prototype._handleKeyDown=function _handleKeyDown(a){if(!this._isUserSearchTypingEvent(a))switch(this.state.isOpen&&(0,_includes3.default)(this.ariaRelevantKeydownCodes,a.which)&&this._arrestEvent(a),a.which){case this.keymap.down:this._onDownKey(a);break;case this.keymap.end:this._onEndKey();break;case this.keymap.enter:this._onEnterKey(a);break;case this.keymap.esc:this._onEscKey();break;case this.keymap.home:this._onHomeKey();break;case this.keymap.space:this._onEnterKey(a);break;case this.keymap.tab:this.state.isOpen?this._onEnterKey(a):this._focusRemovalButtons(a);break;case this.keymap.up:this._onUpKey(a);}},b.prototype._handleSearch=function _handleSearch(a){var b=this;this._arrestEvent(a),this.setState({searchString:a.target.value},function(){b.props.onSearchInputChange(b.state.searchString)})},b.prototype._isCurrentlySelected=function _isCurrentlySelected(a){return(0,_isArray3.default)(this.state.value)?!!(0,_find3.default)(this.state.value,a):(0,_isEqual3.default)(this.state.value,a)},b.prototype._isMultiSelect=function _isMultiSelect(){return this.props.multiple||this.props.tags},b.prototype._isUserSearchTypingEvent=function _isUserSearchTypingEvent(a){return this._rssDOM.searchInput&&a.which!==this.keymap.down&&(a.which!==this.keymap.up||!a.altKey)&&a.which!==this.keymap.esc&&a.target===this._rssDOM.searchInput},b.prototype._mapDataToOptionsMarkup=function _mapDataToOptionsMarkup(a,b){var d=this;return(0,_map3.default)(a,function(a,c){c=b+c;var e='option_'+c,f=!!a.disabled,g=d._isCurrentlySelected(a),h='drop_li_'+a[d.state.valueKey],i=d.state.controlId+'_aria_'+e,j=f?_noop3.default:d._selectItemOnOptionClick.bind(null,a),k=(0,_isFunction3.default)(d.props.customOptionTemplateFunction)?d.props.customOptionTemplateFunction(a,d.state.searchString):a[d.state.labelKey],l=(0,_classnames2.default)('r-ss-dropdown-option',{"r-ss-selected":g,"r-ss-disabled":f});return _react2.default.createElement('li',{ref:function ref(a){d._rssDOM[e]=a},disabled:f,"aria-disabled":f,id:i,tabIndex:'0',"data-option-index":c,className:l,"aria-selected":g,key:h,"data-option-value":a[d.state.valueKey],onClick:j,role:'option'},k)})},b.prototype._moveFocusDown=function _moveFocusDown(){if(!this._needsAjaxFetch()||this.props.searchable){var a;a=(0,_isUndefined3.default)(this.state.focusedId)?this.props.searchable?this.SEARCH_FOCUS_ID:0:this.state.lastOptionId===this.state.focusedId?this.state.lastOptionId:this.state.focusedId+1,this._updateFocusedId(a)}},b.prototype._moveFocusUp=function _moveFocusUp(){var a;(0,_isUndefined3.default)(this.state.focusedId)||this.state.focusedId===this.SEARCH_FOCUS_ID||(0===this.state.focusedId?this.props.searchable&&(a=this.SEARCH_FOCUS_ID):a=this.state.focusedId-1),this._updateFocusedId(a)},b.prototype._needsAjaxFetch=function _needsAjaxFetch(){return(0,_isUndefined3.default)(this.state.rawDataSource)&&(0,_isFunction3.default)(this.props.ajaxDataFetch)},b.prototype._onDownKey=function _onDownKey(a){return this.state.isOpen?void(this._moveFocusDown(),this._isMultiSelect()&&a.shiftKey&&this._selectFocusedOption(a.target,!0)):void this.toggleDropdown()},b.prototype._onEndKey=function _onEndKey(){this.state.lastOptionId&&this._updateFocusedId(this.state.lastOptionId)},b.prototype._onEnterKey=function _onEnterKey(a){if(!this.state.isOpen)return void this.toggleDropdown();if(this._isMultiSelect()&&a.shiftKey)return void this._selectAllOptionsToLastUserSelectedOption(a.target);var b=this._isMultiSelect()&&(a.ctrlKey||a.metaKey);this._selectFocusedOption(a.target,b)},b.prototype._onEscKey=function _onEscKey(){this._closeOnKeypress()},b.prototype._onHomeKey=function _onHomeKey(){this._updateFocusedId(0)},b.prototype._onMouseMove=function _onMouseMove(){if(!this._rssDOM.loader&&(0,_isEmpty3.default)(this.state.searchString)&&this._pageFetchingComplete()){var a=this._rssDOM.scrollWrap;a.scrollTop+a.offsetHeight>=a.scrollHeight&&this.setState({isFetchingPage:!0},this._fetchNextPage)}},b.prototype._onUpKey=function _onUpKey(a){return a.altKey?void this._closeOnKeypress():void(this.state.isOpen&&(this._moveFocusUp(),this._isMultiSelect()&&a.shiftKey&&this._selectFocusedOption(a.target,!0)))},b.prototype._pageFetchingComplete=function _pageFetchingComplete(){return!!(0,_isFunction3.default)(this.props.hasMorePages)&&this.props.hasMorePages(this.state.rawDataSource)},b.prototype._removeAllOptionsInOptionIdRange=function _removeAllOptionsInOptionIdRange(a,b){for(var c=this,d=[],e=a<=b?a:b,f=b>=a?b:a,g=e;g<=f;g++){var i='option_'+g,j=this._rssDOM[i];this.SELECTED_OPTION_REGEX.test(j.getAttribute('class'))&&this.lastUserSelectedOption.getAttribute('data-option-value')!==j.getAttribute('data-option-value')&&d.push(this._getOptionValueFromDataAttr(j))}var h=(0,_reject3.default)(this.state.value,function(a){return(0,_includes3.default)(d,a[c.state.valueKey])});this.setState({value:h},this._broadcastChange)},b.prototype._removeSelectedOptionByValue=function _removeSelectedOptionByValue(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:_noop3.default;this.lastUserSelectedOption&&this.lastUserSelectedOption.getAttribute('data-option-value')===a[this.state.valueKey]&&(this.lastUserSelectedOption=void 0);var d=(0,_reject3.default)(this.state.value,function(c){return c[b.state.valueKey]===a[b.state.valueKey]});this.setState({value:d},function(){c(),b._broadcastChange()})},b.prototype._removeTagKeyPress=function _removeTagKeyPress(a,b){var c=b.which===this.keymap.enter,d=b.which===this.keymap.space;(c||d)&&(this._arrestEvent(b),this._removeSelectedOptionByValue(a,this._setFocusToTagRemovalIfPresent))},b.prototype._removeTagClick=function _removeTagClick(a,b){this._arrestEvent(b),this._removeSelectedOptionByValue(a)},b.prototype._selectAllOptionsInOptionIdRange=function _selectAllOptionsInOptionIdRange(a,b){for(var c=this,d=[],e=a<=b?a:b,f=b>=a?b:a,g=e;g<=f;g++){var i='option_'+g,j=this._rssDOM[i];this.SELECTED_OPTION_REGEX.test(j.getAttribute('class'))||d.push(this._getOptionValueFromDataAttr(j))}var h=(0,_reduce3.default)(this.state.data,function(a,b){return(0,_includes3.default)(d,c._getTypeSafeOptionValue(b[c.state.valueKey]))&&!b.disabled&&a.push(b),a},[]);this._selectItemByValues(h,!0)},b.prototype._selectAllOptionsToLastUserSelectedOption=function _selectAllOptionsToLastUserSelectedOption(a){if(!this.lastUserSelectedOption)return this.lastUserSelectedOption=a,void this._selectAllOptionsInOptionIdRange(0,this._getOptionIndexFromTarget(a));var b=this._getOptionIndexFromTarget(this.lastUserSelectedOption),c=this._getOptionIndexFromTarget(a);if(this.lastUserSelectedOption=a,this.SELECTED_OPTION_REGEX.test(a.getAttribute('class'))){if(!this.props.deselectOnSelectedOptionClick)return!1;this._removeAllOptionsInOptionIdRange(b,c)}else this._selectAllOptionsInOptionIdRange(b,c)},b.prototype._selectFocusedOption=function _selectFocusedOption(a,b){var c=this._getFocusedOptionKey();if(this._rssDOM[c]){if('true'===this._rssDOM[c].getAttribute('aria-disabled'))return!1;var d=this._getOptionValueFromDataAttr(this._rssDOM[c]);if(this.lastUserSelectedOption=a,this.SELECTED_OPTION_REGEX.test(this._rssDOM[c].className)){var e=(0,_head3.default)(this._findArrayOfOptionDataObjectsByValue(d));this._deselectAction(e,b)}else b=b||!1,this._selectItemByValues(d,b)}},b.prototype._selectItemByValues=function _selectItemByValues(a,b){var c=this,d=this._findArrayOfOptionDataObjectsByValue(a),e=b||this.props.keepOpenOnSelection;(this._isMultiSelect()||e&&this.state.value)&&(d=this.state.value.concat(d));var f={value:this._isMultiSelect()?d:[(0,_last3.default)(d)]};this.props.searchable&&this.props.clearSearchOnSelection&&(0,_extend3.default)(f,{searchString:''}),this.setState(f,function(){e?c._updateFocusedId(parseInt(c.lastUserSelectedOption.getAttribute('data-option-index'),10)):c._closeOnKeypress(),c.props.searchable&&c.props.clearSearchOnSelection&&c.props.onSearchInputChange(c.state.searchString),c._broadcastChange()})},b.prototype._selectItemOnOptionClick=function _selectItemOnOptionClick(a,b){if(this._arrestEvent(b),this._isMultiSelect()&&b.shiftKey)return void this._selectAllOptionsToLastUserSelectedOption(b.currentTarget);var c=this._isMultiSelect()&&(b.ctrlKey||b.metaKey),d=this.SELECTED_OPTION_REGEX.test(b.currentTarget.getAttribute('class'));this.lastUserSelectedOption=b.currentTarget,d?this._deselectAction(a,c):this._selectItemByValues(a[this.state.valueKey],c)},b.prototype._setFocusIdToSearch=function _setFocusIdToSearch(){this._updateFocusedId(this.SEARCH_FOCUS_ID)},b.prototype._setFocusOnOpen=function _setFocusOnOpen(){this.lastUserSelectedOption?this._updateFocusedId(parseInt(this.lastUserSelectedOption.getAttribute('data-option-index'),10)):this._moveFocusDown()},b.prototype._setFocusToTagRemovalIfPresent=function _setFocusToTagRemovalIfPresent(){if(!this.props.tags||0===this.state.value.length)return!1;var a=(0,_head3.default)(this.state.value)[this.state.valueKey],b=this._rssDOM[this._getTagRemoveIndex(a)];return!!(b&&(0,_isFunction3.default)(b.focus))&&(b.focus(),!0)},b.prototype._updateFocusedId=function _updateFocusedId(a){this.setState({focusedId:a})},b}(_react2.default.Component);ReactSuperSelect.defaultProps={clearable:!0,clearSelectedValueOnDataSourceChange:!1,closeOnSelectedOptionClick:!0,deselectOnSelectedOptionClick:!0,disabled:!1,keepOpenOnSelection:!1,multiple:!1,openOnMount:!1,focusOnMount:!1,forceDefaultBrowserScrolling:!1,searchable:!1,tags:!1,clearSearchOnSelection:!1,onBlur:_noop3.default,onSearchInputBlur:_noop3.default,onClear:_noop3.default,onCloseDropdown:_noop3.default,onOpenDropdown:_noop3.default,onSearchInputChange:_noop3.default,optionLabelKey:'name',optionValueKey:'id',ajaxErrorString:'An Error occured while fetching options',clearSelectionLabelString:'Clear Selection',clearSearchLabelString:'Clear Search Field',noResultsString:'No Results Available',placeholder:'Select an Option',searchPlaceholder:'Search',tagRemoveLabelString:'Remove Tag'},ReactSuperSelect.propTypes={clearable:_propTypes2.default.bool,clearSelectedValueOnDataSourceChange:_propTypes2.default.bool,closeOnSelectedOptionClick:_propTypes2.default.bool,deselectOnSelectedOptionClick:_propTypes2.default.bool,disabled:_propTypes2.default.bool,keepOpenOnSelection:_propTypes2.default.bool,multiple:_propTypes2.default.bool,openOnMount:_propTypes2.default.bool,focusOnMount:_propTypes2.default.bool,forceDefaultBrowserScrolling:_propTypes2.default.bool,searchable:_propTypes2.default.bool,tags:_propTypes2.default.bool,clearSearchOnSelection:_propTypes2.default.bool,customClass:_propTypes2.default.string,customGroupHeadingClass:_propTypes2.default.string,customSearchIconClass:_propTypes2.default.string,customLoaderClass:_propTypes2.default.string,customTagClass:_propTypes2.default.string,onChange:_propTypes2.default.func.isRequired,onClear:_propTypes2.default.func,onCloseDropdown:_propTypes2.default.func,onSearchInputChange:_propTypes2.default.func,onOpenDropdown:_propTypes2.default.func,onBlur:_propTypes2.default.func,onSearchInputBlur:_propTypes2.default.func,ajaxDataFetch:_propTypes2.default.func,controlId:_propTypes2.default.string,dataSource:_propTypes2.default.oneOfType([_propTypes2.default.arrayOf(_propTypes2.default.object),_propTypes2.default.object]),initialValue:_propTypes2.default.oneOfType([_propTypes2.default.arrayOf(_propTypes2.default.object),_propTypes2.default.object]),optionLabelKey:_propTypes2.default.string,optionValueKey:_propTypes2.default.string,pageDataFetch:_propTypes2.default.func,hasMorePages:_propTypes2.default.func,groupBy:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.func,_propTypes2.default.object]),customGroupHeadingTemplateFunction:_propTypes2.default.func,customFilterFunction:_propTypes2.default.func,customOptionTemplateFunction:_propTypes2.default.func,customSelectedValueTemplateFunction:_propTypes2.default.func,ajaxErrorString:_propTypes2.default.string,clearSelectionLabelString:_propTypes2.default.string,clearSearchLabelString:_propTypes2.default.string,noResultsString:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.element]),placeholder:_propTypes2.default.string,searchPlaceholder:_propTypes2.default.string,tagRemoveLabelString:_propTypes2.default.string},module.exports=ReactSuperSelect;
